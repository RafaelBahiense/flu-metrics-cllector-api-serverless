hello:
  handler: src/status/hello.handler
  events:
    - http:
        path: /status/hello
        method: get
        cors: true
  vpc:
    securityGroupIds:
      - !GetAtt LambdaSecurityGroup.GroupId
    subnetIds:
      - !Ref PrivateSubnet1
      - !Ref PrivateSubnet2

createMetric:
  handler: src/metrics/create.handler
  events:
    - http:
        path: /metrics
        method: post
        cors: true
  vpc:
    securityGroupIds:
      - !GetAtt LambdaSecurityGroup.GroupId
    subnetIds:
      - !Ref PrivateSubnet1
      - !Ref PrivateSubnet2

listMetrics:
  handler: src/metrics/list.handler
  events:
    - http:
        path: /metrics
        method: get
        cors: true
  vpc:
    securityGroupIds:
      - !GetAtt LambdaSecurityGroup.GroupId
    subnetIds:
      - !Ref PrivateSubnet1
      - !Ref PrivateSubnet2

infoGripeAggregate:
  handler: src/metrics/info_gripe_aggregate.handler
  events:
    - http:
        path: /metrics/info-gripe-aggregate
        method: get
        cors: true
  vpc:
    securityGroupIds:
      - !GetAtt LambdaSecurityGroup.GroupId
    subnetIds:
      - !Ref PrivateSubnet1
      - !Ref PrivateSubnet2

migrate:
  handler: src/migrations/run_migrations.handler
  timeout: 300
  memorySize: 512
  environment:
    AWS_STS_REGIONAL_ENDPOINTS: regional
  vpc:
    securityGroupIds:
      - !Ref LambdaSecurityGroup
    subnetIds:
      - !Ref PrivateSubnet1
      - !Ref PrivateSubnet2
  layers:
    - arn:aws:lambda:${self:provider.region}:770693421928:layer:Klayers-p311-SQLAlchemy:1
    - arn:aws:lambda:${self:provider.region}:770693421928:layer:Klayers-p311-psycopg2-binary:1

loadInfoGripe:
  handler: src/load/info_gripe.handler
  timeout: 300
  memorySize: 512
  environment:
    AWS_STS_REGIONAL_ENDPOINTS: regional
  vpc:
    securityGroupIds:
      - !Ref LambdaSecurityGroup
    subnetIds:
      - !Ref PrivateSubnet1
      - !Ref PrivateSubnet2
  layers:
    - arn:aws:lambda:${self:provider.region}:770693421928:layer:Klayers-p311-pandas:1
    - arn:aws:lambda:${self:provider.region}:770693421928:layer:Klayers-p311-psycopg2-binary:1
